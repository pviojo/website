#!/bin/bash
set -euo pipefail

bin="$(dirname $0)"
cd "$bin/.."

BLUE="[1;94m"
RESET="[0m"

main() {
    for subapp in $("$bin"/ls-subapps); do
        echo "$BLUE==> Building $subapp$RESET"

        pushd $subapp
            # Both prod and dev will be installed on most developer machines
            # with just `npm install`, but on Heroku, NODE_ENV is set to
            # production and dev deps won't be installed.
            npm install --only=prod
            npm install --only=dev
            npm run build
        popd
    done
}

main "$@"
