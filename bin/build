#!/bin/bash
set -euo pipefail

cd "$(dirname $0)/.."

BLUE="[1;94m"
RESET="[0m"

main() {
    for subapp in $(subapps); do
        if [[ $subapp == template-react-app ]]; then
            continue
        fi

        echo "$BLUE==> Building $subapp$RESET"

        pushd $subapp
            # Both prod and dev will be installed on most developer machines
            # with just `npm install`, but on Heroku, NODE_ENV is set to
            # production and dev deps won't be installed.
            npm install --only=prod
            npm install --only=dev
            npm run build
        popd
    done
}

subapps() {
    ls -1 */package.json | cut -d/ -f1
}

main "$@"
